{
  "file_name": "12_payout_summary_transaction_breakdown.sql",
  "timestamp": "/Users/sharlenechew/redshift-semantic",
  "business_question": "To perform a financial audit for the merchant 'piccolilotti' for January 2025, I need a transaction-level reconciliation report. For each online sale, please break down every financial component: gross transaction amount, all fees, logistic costs vs. profits, and the internal cost attribution for any vouchers used.",
  "golden_sql": "with txn as (\nselect distinct \n    tr.receiptnumber,\n    tr.createdtime,\n    tr.business,\n    b.country,\n    tr._id,\n    tr.status,\n    tr.channel,\n    tr.shippingtype,\n    tr.isdisbursed,\n    tr.total\n    \nfrom storehub_mongo.transactionrecords tr\n\nleft join storehub_mongo.businesses b\n    on b.name = tr.business\n    \nwhere (tr.channel = 1 or tr.channel = 3)\n    and tr.business != 'merchandise'\n    --and tr.status not in ('created', 'failed', 'paymentCancelled', 'pendingPayment', 'pendingVerification')\n    and (tr.createdtime >= dateadd(hour,-8,'2025-01-01') and tr.createdtime < dateadd(hour,-8,'2025-02-01'))\n    and tr.business = 'piccolilotti'\n    and b.country = 'MY'\n),\n\npo as (\nselect \n    pi.*,\n    bp.createdtime as bptime\n\nfrom storehub_mongo.payoutitems pi\n\nleft join storehub_mongo.batchpayouts bp\n    on bp._id = pi.batchpayoutid\n)\n/*,\n\npromo as (\nselect \n    trpromo.transactionrecords_foreignkey,\n    sum(trpromo.discount * trpromo.shpercent) as tot_disc\n    \nfrom (\n    select \n        trp.transactionrecords_foreignkey,\n        case \n            when trp.discount is not null and trp.shippingfeediscount is not null then trp.discount + trp.shippingfeediscount\n            when trp.discount is not null then trp.discount\n            when trp.shippingfeediscount is not null then trp.shippingfeediscount\n            else 0 \n        end as discount,\n        trp.storehubpaidpercentage as shpercent\n        --cast(discount as float) * cast(shpercent as float) as tot_discount\n    from storehub_mongo.transactionrecords__promotions trp \n        \n    union\n        \n    select\n        trip.transactionrecords_foreignkey,\n        trip.discount as discount,\n        trip.storehubpaidpercentage as shpercent\n        --sum(discount * shpercent) as tot_discount\n    from storehub_mongo.transactionrecords__items__promotions trip\n    \n    where trip.promotiontype = 'universal' \n        and trip.storehubpaidpercentage > 0\n    ) trpromo\n\ngroup by 1\n)\n*/\n\nselect distinct \n    dateadd(hour,8,txn.createdtime) as \"Transaction time\",\n    dateadd(hour,8,po.bptime) as \"Payout time\",\n    txn.country,\n    txn.business, \n    txn.receiptnumber as \"receipt number\",\n    txn._id as \"transaction id\",\n    txn.status,\n    case \n        when txn.channel = 1 then 'Ecomm'\n        when txn.channel = 3 then 'Beep'\n    end as \"channel\",\n    case\n        when txn.channel = 3 and txn.shippingtype in ('delivery','pickup') then 'Beep Delivery'\n        when txn.channel = 3 and txn.shippingtype in ('takeaway','dineIn') then 'Beep QR'\n        when txn.channel = 1 then 'Ecomm'\n    end as \"channel2\",\n    txn.shippingtype,\n    trdi.usestorehublogistics,\n    trdi.courier,\n    txn.isdisbursed,\n    txn.total as \"Transaction Amount\",\n    --trpm.paymentprovider,\n    --trpm.paymentgateway,\n    --gr.paymentgateway,\n    po.paymentgateway as \"payment gateway\",\n    po.cause as \"Payout reason\",\n    po.amount as \"Payout amount\",\n    --\"Payout amount - Sell\" + \"Payout amount - Adjustment\" as \"Total Payout amount\",\n    -- sum(trav.value) as \"Voucher value\",\n    case \n        when trav._id is not null and trav.purchasechannel = 'cleverTapWebhook' then trav.value\n        when trav._id is not null and trav.purchasechannel = 'ist' and lower(trav.remarks) like 'marketing/%' and trav.remarks not like '%VBeepGiftVouchers/%' then trav.value\n        else 0\n    end as \"Voucher payout - MKT\",\n    case\n        when trav._id is not null and trav.purchasechannel = 'ist' and lower(trav.remarks) like 'people/%' then trav.value\n        else 0\n    end as \"Voucher payout - People\",\n    case\n        when trav._id is not null and trav.purchasechannel = 'ist' and lower(trav.remarks) like 'care/%' then trav.value\n        when trav._id is not null and trav.purchasechannel = 'ist' and trav.remarks = '' then trav.value\n        when trav._id is not null and trav.purchasechannel = 'systemRefund' then trav.value\n        else 0\n    end as \"Voucher payout - Care\",\n    case\n        when trav._id is not null and trav.purchasechannel = 'ist' and lower(trav.remarks) like 'product/%' then trav.value\n        else 0\n    end as \"Voucher payout - Product\",\n    case\n        when trav._id is not null and trav.purchasechannel = 'ist' and trav.remarks like '%VBeepGiftVouchers/%' then trav.value\n        else 0\n    end as \"Voucher payout - Sold\",\n    case\n        when trav._id is not null and trav.purchasechannel = 'ist' and trav.remarks <> '' and (lower(trav.remarks) not like 'product/%' and lower(trav.remarks) not like 'care/%' and lower(trav.remarks) not like 'marketing/%' and lower(trav.remarks) not like 'people/%' and trav.remarks not like '%VBeepGiftVouchers/%') then trav.value \n        when trav._id is not null and trav.purchasechannel = '' then trav.value\n        else 0\n    end as \"Voucher payout - Others\",\n    case\n        when trav._id is not null and trav.purchasechannel = 'beep' then trav.value\n        else 0\n    end as \"Merchant Beep Voucher\",\n    trav.coveredbysh,\n    /*sum(case \n            when trav.purchasechannel = 'beep' then 0\n            when trav._id is not null then trav.value\n            else 0 end) as \"Total voucher payout\",*/\n    (case when po.cause = 'sell' then isnull(gr.fee,0) - isnull(pso.paymentgatewaycost,0) else 0 end) as \"Payment Gateway Cost\",\n    isnull(po.paymentgatewayfee,0) as \"Payment Gateway Fee\",\n    -(\"Payment Gateway Fee\" - \"Payment Gateway Cost\") as \"Payment Gateway Profit\",\n    (case when po.cause = 'sell' then trdi.shippingfee else 0 end) as \"Customer paid delivery fee\",\n    -(case when po.cause = 'sell' and trdi.courier != 'onfleet' then trdi.deliveryfee else 0 end) as \"Logistic Cost (OnFleet excluded)\",\n    (case when trdi.courier != 'onfleet' then po.logisticsfee else 0 end) as \"Logistic Fee (OnFleet excluded)\",\n    -(\"Logistic Fee (OnFleet excluded)\" - \"Logistic Cost (OnFleet excluded)\") as \"Logistic Profit (Onfleet excluded)\",\n    -(po.transactionfee) as \"Storehub Fee (Transaction Fee)\",\n    --count(distinct pi.receiptnumber) as \"# of txn\",\n    (case when trdi.courier = 'onfleet' then po.logisticsfee else 0 end) as \"Logistic Fee (OnFleet only)\",\n    --sum(case when pi.cause = 'adjustment' then pi.amount else 0 end) as \"Adjustment Amount\",\n    --(case when po.cause = 'sell' then isnull(promo.tot_disc,0) else 0 end) as \"Storehub Paid Promo Discount\",\n    (case when po.cause = 'sell' then isnull(po.promotionamount,0) else 0 end) as \"Storehub Paid Promo Amount\",\n    --(case when po.cause = 'sell' then isnull(po.voucheramount,0) else 0 end) as \"Storehub Paid Voucher Amount\",\n    (case when po.cause = 'sell' then isnull(po.refundedamount,0) else 0 end) as \"Refunded Amount\",\n    (case when po.cause = 'sell' then po.pickupsmsfee else 0 end) as \"pick up sms fee\"\n\nfrom txn\n    \nleft join po \n    on po.receiptnumber = txn.receiptnumber\n\n--left join promo\n--    on promo.transactionrecords_foreignkey = txn._id\n\nleft join (\n    select \n        ta._id,\n        ta.voucherid,\n        ta.purchasechannel,\n        vc.remarks, \n        ta.value,\n        ta.transactionrecords_foreignkey,\n        ta.coveredbysh\n    from storehub_mongo.transactionrecords__appliedvoucher ta\n    left join storehub_mongo.vouchers vc\n        on ta.voucherid = vc._id\n    ) trav\n    on trav.transactionrecords_foreignkey = txn._id\n\nleft join storehub_mongo.transactionrecords__deliveryinformation trdi \n    on trdi.transactionrecords_foreignkey = txn._id\n    \nleft join (\n    select * \n    from storehub_mongo.gatewayrecords gr\n    where gr.transactiontype = 'payment' \n        and gr.reconstatus = 'passed'\n    ) gr \n    on gr.receiptnumber = po.receiptnumber\n\nleft join storehub_mongo.paymentsettlements__orders pso \n    on pso.receiptnumber = txn.receiptnumber\n\nleft join storehub_mongo.transactionrecords__payments trpm \n    on trpm.transactionrecords_foreignkey = txn._id\n\nwhere txn.status not in ('created', 'failed', 'paymentCancelled', 'pendingPayment', 'pendingVerification')\n    --and (tr.channel = 1 or tr.channel = 3)\n    --and (pi.cause = 'sell' or pi.cause = 'cancel')\n    --and tr.business != 'merchandise'\n    --and NOT (lower(b.\"planid\") like '%internal%')\n    --AND tr.\"status\" <> 'cancelled' AND tr.\"status\" <> 'failed' AND tr.\"status\" <> 'paymentCancelled' AND tr.\"status\" <> 'pendingPayment' AND tr.\"status\" <> 'pendingVerification' AND tr.\"status\" <> 'created'\n    --and tr.receiptnumber in ('803984100346862','802709001037705','803678576452200','802351208741894','803917265829970','803614169112991','803539823849427')\n    --and txn.receiptnumber in ('807865893205675','807247408750412','807247613545480')\n\n--group by 1,2,3,4,5,6,7,8,9,10,11,12,13\norder by \"Transaction time\" desc,  \"receipt number\" ASC, \"Payout reason\" DESC",
  "ai_generated_sql": "SELECT\n    tr.transaction_id,\n    tr.gross_amount,\n    tr.fees,\n    tr.logistic_costs,\n    tr.logistic_profits,\n    pi.voucher_cost\nFROM\n    transactionrecords AS tr\nLEFT JOIN\n    payoutitems__storehubdetails AS pi ON tr.transaction_id = pi.transaction_id\nWHERE\n    tr.business = 'piccolilotti'\n    AND (tr.isdeleted != TRUE OR tr.isdeleted IS NULL)\n    AND tr.type IN ('Sale', 'Return')\n    AND tr.createdtime <= CURRENT_TIMESTAMP + INTERVAL '1 day'\n    AND tr.transaction_time >= '2025-01-01' AND tr.transaction_time < '2025-02-01'\n    AND tr.sales_channel = 'Online' -- Added based on \"online sale\" in the prompt\n;",
  "framework_context_length": 2383,
  "framework_files_loaded": [
    "semantic_context",
    "data_catalog",
    "business_rules",
    "query_patterns",
    "value_mappings",
    "query_cookbook"
  ],
  "api_result": {
    "success": true,
    "status_code": 202,
    "data": {
      "database_id": 2,
      "started_at": "2025-07-29T16:24:08.41022Z",
      "via": [
        {
          "status": "failed",
          "class": "class clojure.lang.ExceptionInfo",
          "error": "Error executing query: ERROR: relation \"transactionrecords\" does not exist",
          "stacktrace": [
            "--> driver.sql_jdbc.execute$execute_reducible_query$fn__79031$fn__79032.invoke(execute.clj:701)",
            "driver.sql_jdbc.execute$execute_reducible_query$fn__79031.invoke(execute.clj:698)",
            "driver.redshift$fn__119979$fn__119981.invoke(redshift.clj:138)",
            "driver.sql_jdbc.execute$do_with_resolved_connection.invokeStatic(execute.clj:334)",
            "driver.sql_jdbc.execute$do_with_resolved_connection.invoke(execute.clj:317)",
            "driver.redshift$fn__119979.invokeStatic(redshift.clj:123)",
            "driver.redshift$fn__119979.invoke(redshift.clj:121)",
            "driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:692)",
            "driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:678)",
            "driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:689)",
            "driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:678)",
            "driver.sql_jdbc$fn__106344.invokeStatic(sql_jdbc.clj:78)",
            "driver.sql_jdbc$fn__106344.invoke(sql_jdbc.clj:76)",
            "query_processor.context$executef.invokeStatic(context.clj:60)",
            "query_processor.context$executef.invoke(context.clj:49)",
            "query_processor.context.default$default_runf.invokeStatic(default.clj:44)",
            "query_processor.context.default$default_runf.invoke(default.clj:42)",
            "query_processor.context$runf.invokeStatic(context.clj:46)",
            "query_processor.context$runf.invoke(context.clj:40)",
            "query_processor.reducible$identity_qp.invokeStatic(reducible.clj:39)",
            "query_processor.reducible$identity_qp.invoke(reducible.clj:36)",
            "query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___71961.invoke(cache.clj:229)",
            "query_processor.middleware.permissions$check_query_permissions$fn__66347.invoke(permissions.clj:140)",
            "query_processor.middleware.enterprise$check_download_permissions_middleware$fn__71782.invoke(enterprise.clj:51)",
            "query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__71792.invoke(enterprise.clj:64)",
            "query_processor.middleware.mbql_to_native$mbql__GT_native$fn__71224.invoke(mbql_to_native.clj:24)",
            "query_processor$fn__73106$combined_post_process__73111$combined_post_process_STAR___73112.invoke(query_processor.clj:262)",
            "query_processor$fn__73106$combined_pre_process__73107$combined_pre_process_STAR___73108.invoke(query_processor.clj:259)",
            "query_processor.middleware.fetch_source_query$resolve_card_id_source_tables$fn__66444.invoke(fetch_source_query.clj:303)",
            "query_processor.middleware.resolve_database_and_driver$resolve_driver_and_database_local_values$fn__71872$fn__71876.invoke(resolve_database_and_driver.clj:77)",
            "driver$do_with_driver.invokeStatic(driver.clj:97)",
            "driver$do_with_driver.invoke(driver.clj:92)",
            "query_processor.middleware.resolve_database_and_driver$resolve_driver_and_database_local_values$fn__71872.invoke(resolve_database_and_driver.clj:76)",
            "query_processor.middleware.store$initialize_store$fn__67050$fn__67051.invoke(store.clj:14)",
            "query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:169)",
            "query_processor.store$do_with_metadata_provider.invoke(store.clj:150)",
            "query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:158)",
            "query_processor.store$do_with_metadata_provider.invoke(store.clj:150)",
            "query_processor.middleware.store$initialize_store$fn__67050.invoke(store.clj:13)",
            "query_processor.middleware.resolve_database_and_driver$resolve_database$fn__71869.invoke(resolve_database_and_driver.clj:60)",
            "query_processor.middleware.normalize_query$normalize$fn__72174.invoke(normalize_query.clj:38)",
            "query_processor.middleware.enterprise$fn__71809$handle_audit_app_internal_queries__71810$fn__71812.invoke(enterprise.clj:96)",
            "query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__71820.invoke(enterprise.clj:103)",
            "query_processor.middleware.constraints$mark_needs_default_userland_constraints$fn__70935.invoke(constraints.clj:104)",
            "query_processor.middleware.process_userland_query$process_userland_query$fn__72105.invoke(process_userland_query.clj:156)",
            "query_processor.middleware.catch_exceptions$catch_exceptions$fn__72706.invoke(catch_exceptions.clj:171)",
            "query_processor.reducible$async_qp$qp_STAR___62605$thunk__62607.invoke(reducible.clj:126)",
            "query_processor.reducible$async_qp$qp_STAR___62605.invoke(reducible.clj:132)",
            "query_processor.reducible$sync_qp$qp_STAR___62617.doInvoke(reducible.clj:153)",
            "query_processor$process_userland_query.invokeStatic(query_processor.clj:402)",
            "query_processor$process_userland_query.doInvoke(query_processor.clj:398)",
            "query_processor$process_query_and_save_execution_BANG_.invokeStatic(query_processor.clj:416)",
            "query_processor$process_query_and_save_execution_BANG_.invoke(query_processor.clj:406)",
            "query_processor$process_query_and_save_with_max_results_constraints_BANG_.invokeStatic(query_processor.clj:431)",
            "query_processor$process_query_and_save_with_max_results_constraints_BANG_.invoke(query_processor.clj:421)",
            "api.dataset$run_query_async$fn__93567.invoke(dataset.clj:79)",
            "query_processor.streaming$streaming_response_STAR_$fn__53135$fn__53137.invoke(streaming.clj:168)",
            "query_processor.streaming$streaming_response_STAR_$fn__53135.invoke(streaming.clj:167)",
            "async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:69)",
            "async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:67)",
            "async.streaming_response$do_f_async$task__43750.invoke(streaming_response.clj:88)"
          ],
          "error_type": "invalid-query",
          "ex-data": {
            "driver": "redshift",
            "sql": [
              "-- /* partner: \"metabase\", {\"dashboard_id\":null,\"chart_id\":null,\"optional_user_id\":477,\"optional_account_id\":\"0a0eeb39-1c3d-4f8f-a7cc-96bace83599a\",\"filter_values\":{}} */ Metabase:: userID: 477 queryType: native queryHash: ca63c53f70f1e1b657441d9a77380e861ae48b23c92c49c002aac5bce4eb7675",
              "SELECT",
              "  tr.transaction_id,",
              "  tr.gross_amount,",
              "  tr.fees,",
              "  tr.logistic_costs,",
              "  tr.logistic_profits,",
              "  pi.voucher_cost",
              "FROM",
              "  transactionrecords AS tr",
              "  LEFT JOIN payoutitems__storehubdetails AS pi ON tr.transaction_id = pi.transaction_id",
              "WHERE",
              "  tr.business = 'piccolilotti'",
              "  AND (",
              "    tr.isdeleted != TRUE",
              "    OR tr.isdeleted IS NULL",
              "  )",
              "  AND tr.type IN ('Sale', 'Return')",
              "  AND tr.createdtime <= CURRENT_TIMESTAMP + INTERVAL '1 day'",
              "  AND tr.transaction_time >= '2025-01-01'",
              "  AND tr.transaction_time < '2025-02-01'",
              "  AND tr.sales_channel = 'Online' -- Added based on \"online sale\" in the prompt",
              ";"
            ],
            "params": null,
            "type": "invalid-query"
          }
        }
      ],
      "action_id": null,
      "state": "42P01",
      "error_type": "invalid-query",
      "json_query": {
        "database": 2,
        "type": "native",
        "native": {
          "query": "SELECT\n    tr.transaction_id,\n    tr.gross_amount,\n    tr.fees,\n    tr.logistic_costs,\n    tr.logistic_profits,\n    pi.voucher_cost\nFROM\n    transactionrecords AS tr\nLEFT JOIN\n    payoutitems__storehubdetails AS pi ON tr.transaction_id = pi.transaction_id\nWHERE\n    tr.business = 'piccolilotti'\n    AND (tr.isdeleted != TRUE OR tr.isdeleted IS NULL)\n    AND tr.type IN ('Sale', 'Return')\n    AND tr.createdtime <= CURRENT_TIMESTAMP + INTERVAL '1 day'\n    AND tr.transaction_time >= '2025-01-01' AND tr.transaction_time < '2025-02-01'\n    AND tr.sales_channel = 'Online' -- Added based on \"online sale\" in the prompt\n;"
        },
        "middleware": {
          "js-int-to-string?": true,
          "add-default-userland-constraints?": true
        }
      },
      "status": "failed",
      "class": "class com.amazon.redshift.util.RedshiftException",
      "stacktrace": [
        "com.amazon.redshift.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2613)",
        "com.amazon.redshift.core.v3.QueryExecutorImpl.processResultsOnThread(QueryExecutorImpl.java:2281)",
        "com.amazon.redshift.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:1886)",
        "com.amazon.redshift.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:1878)",
        "com.amazon.redshift.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:375)",
        "com.amazon.redshift.jdbc.RedshiftStatementImpl.executeInternal(RedshiftStatementImpl.java:515)",
        "com.amazon.redshift.jdbc.RedshiftStatementImpl.execute(RedshiftStatementImpl.java:436)",
        "com.amazon.redshift.jdbc.RedshiftStatementImpl.executeWithFlags(RedshiftStatementImpl.java:377)",
        "com.amazon.redshift.jdbc.RedshiftStatementImpl.executeCachedSql(RedshiftStatementImpl.java:363)",
        "com.amazon.redshift.jdbc.RedshiftStatementImpl.executeWithFlags(RedshiftStatementImpl.java:340)",
        "com.amazon.redshift.jdbc.RedshiftStatementImpl.execute(RedshiftStatementImpl.java:330)",
        "com.mchange.v2.c3p0.impl.NewProxyStatement.execute(NewProxyStatement.java:75)",
        "--> driver.sql_jdbc.execute$fn__78950.invokeStatic(execute.clj:560)",
        "driver.sql_jdbc.execute$fn__78950.invoke(execute.clj:558)",
        "driver.sql_jdbc.execute$execute_statement_or_prepared_statement_BANG_.invokeStatic(execute.clj:568)",
        "driver.sql_jdbc.execute$execute_statement_or_prepared_statement_BANG_.invoke(execute.clj:565)",
        "driver.sql_jdbc.execute$execute_reducible_query$fn__79031$fn__79032.invoke(execute.clj:699)",
        "driver.sql_jdbc.execute$execute_reducible_query$fn__79031.invoke(execute.clj:698)",
        "driver.redshift$fn__119979$fn__119981.invoke(redshift.clj:138)",
        "driver.sql_jdbc.execute$do_with_resolved_connection.invokeStatic(execute.clj:334)",
        "driver.sql_jdbc.execute$do_with_resolved_connection.invoke(execute.clj:317)",
        "driver.redshift$fn__119979.invokeStatic(redshift.clj:123)",
        "driver.redshift$fn__119979.invoke(redshift.clj:121)",
        "driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:692)",
        "driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:678)",
        "driver.sql_jdbc.execute$execute_reducible_query.invokeStatic(execute.clj:689)",
        "driver.sql_jdbc.execute$execute_reducible_query.invoke(execute.clj:678)",
        "driver.sql_jdbc$fn__106344.invokeStatic(sql_jdbc.clj:78)",
        "driver.sql_jdbc$fn__106344.invoke(sql_jdbc.clj:76)",
        "query_processor.context$executef.invokeStatic(context.clj:60)",
        "query_processor.context$executef.invoke(context.clj:49)",
        "query_processor.context.default$default_runf.invokeStatic(default.clj:44)",
        "query_processor.context.default$default_runf.invoke(default.clj:42)",
        "query_processor.context$runf.invokeStatic(context.clj:46)",
        "query_processor.context$runf.invoke(context.clj:40)",
        "query_processor.reducible$identity_qp.invokeStatic(reducible.clj:39)",
        "query_processor.reducible$identity_qp.invoke(reducible.clj:36)",
        "query_processor.middleware.cache$maybe_return_cached_results$maybe_return_cached_results_STAR___71961.invoke(cache.clj:229)",
        "query_processor.middleware.permissions$check_query_permissions$fn__66347.invoke(permissions.clj:140)",
        "query_processor.middleware.enterprise$check_download_permissions_middleware$fn__71782.invoke(enterprise.clj:51)",
        "query_processor.middleware.enterprise$maybe_apply_column_level_perms_check_middleware$fn__71792.invoke(enterprise.clj:64)",
        "query_processor.middleware.mbql_to_native$mbql__GT_native$fn__71224.invoke(mbql_to_native.clj:24)",
        "query_processor$fn__73106$combined_post_process__73111$combined_post_process_STAR___73112.invoke(query_processor.clj:262)",
        "query_processor$fn__73106$combined_pre_process__73107$combined_pre_process_STAR___73108.invoke(query_processor.clj:259)",
        "query_processor.middleware.fetch_source_query$resolve_card_id_source_tables$fn__66444.invoke(fetch_source_query.clj:303)",
        "query_processor.middleware.resolve_database_and_driver$resolve_driver_and_database_local_values$fn__71872$fn__71876.invoke(resolve_database_and_driver.clj:77)",
        "driver$do_with_driver.invokeStatic(driver.clj:97)",
        "driver$do_with_driver.invoke(driver.clj:92)",
        "query_processor.middleware.resolve_database_and_driver$resolve_driver_and_database_local_values$fn__71872.invoke(resolve_database_and_driver.clj:76)",
        "query_processor.middleware.store$initialize_store$fn__67050$fn__67051.invoke(store.clj:14)",
        "query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:169)",
        "query_processor.store$do_with_metadata_provider.invoke(store.clj:150)",
        "query_processor.store$do_with_metadata_provider.invokeStatic(store.clj:158)",
        "query_processor.store$do_with_metadata_provider.invoke(store.clj:150)",
        "query_processor.middleware.store$initialize_store$fn__67050.invoke(store.clj:13)",
        "query_processor.middleware.resolve_database_and_driver$resolve_database$fn__71869.invoke(resolve_database_and_driver.clj:60)",
        "query_processor.middleware.normalize_query$normalize$fn__72174.invoke(normalize_query.clj:38)",
        "query_processor.middleware.enterprise$fn__71809$handle_audit_app_internal_queries__71810$fn__71812.invoke(enterprise.clj:96)",
        "query_processor.middleware.enterprise$handle_audit_app_internal_queries_middleware$fn__71820.invoke(enterprise.clj:103)",
        "query_processor.middleware.constraints$mark_needs_default_userland_constraints$fn__70935.invoke(constraints.clj:104)",
        "query_processor.middleware.process_userland_query$process_userland_query$fn__72105.invoke(process_userland_query.clj:156)",
        "query_processor.middleware.catch_exceptions$catch_exceptions$fn__72706.invoke(catch_exceptions.clj:171)",
        "query_processor.reducible$async_qp$qp_STAR___62605$thunk__62607.invoke(reducible.clj:126)",
        "query_processor.reducible$async_qp$qp_STAR___62605.invoke(reducible.clj:132)",
        "query_processor.reducible$sync_qp$qp_STAR___62617.doInvoke(reducible.clj:153)",
        "query_processor$process_userland_query.invokeStatic(query_processor.clj:402)",
        "query_processor$process_userland_query.doInvoke(query_processor.clj:398)",
        "query_processor$process_query_and_save_execution_BANG_.invokeStatic(query_processor.clj:416)",
        "query_processor$process_query_and_save_execution_BANG_.invoke(query_processor.clj:406)",
        "query_processor$process_query_and_save_with_max_results_constraints_BANG_.invokeStatic(query_processor.clj:431)",
        "query_processor$process_query_and_save_with_max_results_constraints_BANG_.invoke(query_processor.clj:421)",
        "api.dataset$run_query_async$fn__93567.invoke(dataset.clj:79)",
        "query_processor.streaming$streaming_response_STAR_$fn__53135$fn__53137.invoke(streaming.clj:168)",
        "query_processor.streaming$streaming_response_STAR_$fn__53135.invoke(streaming.clj:167)",
        "async.streaming_response$do_f_STAR_.invokeStatic(streaming_response.clj:69)",
        "async.streaming_response$do_f_STAR_.invoke(streaming_response.clj:67)",
        "async.streaming_response$do_f_async$task__43750.invoke(streaming_response.clj:88)"
      ],
      "card_id": null,
      "context": "ad-hoc",
      "error": "ERROR: relation \"transactionrecords\" does not exist",
      "row_count": 0,
      "running_time": 0,
      "data": {
        "rows": [],
        "cols": []
      }
    },
    "row_count": 0,
    "query": "SELECT\n    tr.transaction_id,\n    tr.gross_amount,\n    tr.fees,\n    tr.logistic_costs,\n    tr.logistic_profits,\n    pi.voucher_cost\nFROM\n    transactionrecords AS tr\nLEFT JOIN\n    payoutitems__storehubdetails AS pi ON tr.transaction_id = pi.transaction_id\nWHERE\n    tr.business = 'piccolilotti'\n    AND (tr.isdeleted != TRUE OR tr.isdeleted IS NULL)\n    AND tr.type IN ('Sale', 'Return')\n    AND tr.createdtime <= CURRENT_TIMESTAMP + INTERVAL '1 day'\n    AND tr.transaction_time >= '2025-01-01' AND tr.transaction_time < '2025-02-01'\n    AND tr.sales_channel = 'Online' -- Added based on \"online sale\" in the prompt\n;"
  }
}