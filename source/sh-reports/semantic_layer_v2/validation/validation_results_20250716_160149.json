{
  "success": false,
  "error": "{\"data\":{\"rows\":[\n\n],\n\"cols\":[{\"display_name\":\"month_code\",\"source\":\"native\",\"field_ref\":[\"field\",\"month_code\",{\"base-type\":\"type/Text\"}],\"name\":\"month_code\",\"base_type\":\"type/Text\",\"effective_type\":\"type/Text\"},{\"display_name\":\"month_name\",\"source\":\"native\",\"field_ref\":[\"field\",\"month_name\",{\"base-type\":\"type/Text\"}],\"name\":\"month_name\",\"base_type\":\"type/Text\",\"effective_type\":\"type/Text\"},{\"display_name\":\"gross_sales\",\"source\":\"native\",\"field_ref\":[\"field\",\"gross_sales\",{\"base-type\":\"type/Decimal\"}],\"name\":\"gross_sales\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\"},{\"display_name\":\"returns\",\"source\":\"native\",\"field_ref\":[\"field\",\"returns\",{\"base-type\":\"type/Decimal\"}],\"name\":\"returns\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\"},{\"display_name\":\"discounts\",\"source\":\"native\",\"field_ref\":[\"field\",\"discounts\",{\"base-type\":\"type/Decimal\"}],\"name\":\"discounts\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\"},{\"display_name\":\"tax\",\"source\":\"native\",\"field_ref\":[\"field\",\"tax\",{\"base-type\":\"type/Decimal\"}],\"name\":\"tax\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\"},{\"display_name\":\"net_sales\",\"source\":\"native\",\"field_ref\":[\"field\",\"net_sales\",{\"base-type\":\"type/Decimal\"}],\"name\":\"net_sales\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\"},{\"display_name\":\"total_revenue\",\"source\":\"native\",\"field_ref\":[\"field\",\"total_revenue\",{\"base-type\":\"type/Decimal\"}],\"name\":\"total_revenue\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\"},{\"display_name\":\"sale_transactions\",\"source\":\"native\",\"field_ref\":[\"field\",\"sale_transactions\",{\"base-type\":\"type/BigInteger\"}],\"name\":\"sale_transactions\",\"base_type\":\"type/BigInteger\",\"effective_type\":\"type/BigInteger\"},{\"display_name\":\"return_transactions\",\"source\":\"native\",\"field_ref\":[\"field\",\"return_transactions\",{\"base-type\":\"type/BigInteger\"}],\"name\":\"return_transactions\",\"base_type\":\"type/BigInteger\",\"effective_type\":\"type/BigInteger\"},{\"display_name\":\"total_transactions\",\"source\":\"native\",\"field_ref\":[\"field\",\"total_transactions\",{\"base-type\":\"type/BigInteger\"}],\"name\":\"total_transactions\",\"base_type\":\"type/BigInteger\",\"effective_type\":\"type/BigInteger\"},{\"display_name\":\"unique_customers\",\"source\":\"native\",\"field_ref\":[\"field\",\"unique_customers\",{\"base-type\":\"type/BigInteger\"}],\"name\":\"unique_customers\",\"base_type\":\"type/BigInteger\",\"effective_type\":\"type/BigInteger\"},{\"display_name\":\"avg_transaction_value\",\"source\":\"native\",\"field_ref\":[\"field\",\"avg_transaction_value\",{\"base-type\":\"type/Decimal\"}],\"name\":\"avg_transaction_value\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\"},{\"display_name\":\"return_rate_percent\",\"source\":\"native\",\"field_ref\":[\"field\",\"return_rate_percent\",{\"base-type\":\"type/Decimal\"}],\"name\":\"return_rate_percent\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\"},{\"display_name\":\"discount_rate_percent\",\"source\":\"native\",\"field_ref\":[\"field\",\"discount_rate_percent\",{\"base-type\":\"type/Decimal\"}],\"name\":\"discount_rate_percent\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\"},{\"display_name\":\"customers_per_transaction\",\"source\":\"native\",\"field_ref\":[\"field\",\"customers_per_transaction\",{\"base-type\":\"type/Decimal\"}],\"name\":\"customers_per_transaction\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\"}],\"native_form\":{\"query\":\"\\nWITH merchant_info AS (\\n  SELECT \\n    b._id as business_id,\\n    b.name as business_name,\\n    COALESCE(b.timezone, 'Asia/Kuala_Lumpur') as timezone\\n  FROM storehub_mongo.businesses b\\n  WHERE b.name = 'nasikukusnkb' \\n     OR b._id = 'nasikukusnkb'\\n  LIMIT 1\\n),\\n\\nmonthly_sales AS (\\n  SELECT \\n    DATE_TRUNC('month', CONVERT_TIMEZONE(mi.timezone, 'UTC', tr.createdtime)) as sales_month,\\n    \\n    SUM(CASE WHEN tr.transactiontype = 'Sale' THEN tr.subtotal ELSE 0 END) as gross_sales,\\n    \\n    SUM(CASE \\n      WHEN tr.transactiontype = 'Return' THEN ABS(tr.subtotal)\\n      WHEN tr.returnstatus IS NOT NULL AND tr.returnstatus != '' THEN ABS(tr.subtotal) \\n      ELSE 0 \\n    END) as returns,\\n    \\n    SUM(CASE WHEN tr.transactiontype = 'Sale' THEN COALESCE(tr.discount, 0) ELSE 0 END) as total_discounts,\\n    \\n    SUM(CASE WHEN tr.transactiontype = 'Sale' THEN COALESCE(tr.tax, 0) ELSE 0 END) as tax_collected,\\n    \\n    SUM(CASE \\n      WHEN tr.transactiontype = 'Sale' THEN tr.subtotal - COALESCE(tr.discount, 0)\\n      WHEN tr.transactiontype = 'Return' THEN -ABS(tr.subtotal)\\n      WHEN tr.returnstatus IS NOT NULL AND tr.returnstatus != '' THEN -ABS(tr.subtotal)\\n      ELSE 0 \\n    END) as net_sales,\\n    \\n    SUM(CASE \\n      WHEN tr.transactiontype = 'Sale' THEN tr.total\\n      WHEN tr.transactiontype = 'Return' THEN -ABS(tr.total)\\n      WHEN tr.returnstatus IS NOT NULL AND tr.returnstatus != '' THEN -ABS(tr.total)\\n      ELSE 0 \\n    END) as total_revenue,\\n    \\n    COUNT(DISTINCT CASE WHEN tr.transactiontype = 'Sale' THEN tr.receiptnumber END) as sale_transactions,\\n    COUNT(DISTINCT CASE \\n      WHEN tr.transactiontype = 'Return' THEN tr.receiptnumber \\n      WHEN tr.returnstatus IS NOT NULL AND tr.returnstatus != '' THEN tr.receiptnumber\\n    END) as return_transactions,\\n    COUNT(DISTINCT tr.receiptnumber) as total_transactions,\\n    \\n    COUNT(DISTINCT CASE WHEN tr.transactiontype = 'Sale' AND tr.customerid IS NOT NULL THEN tr.customerid END) as unique_customers\\n    \\n  FROM storehub_mongo.transactionrecords tr\\n  CROSS JOIN merchant_info mi\\n  WHERE \\n    tr.business = mi.business_id\\n    \\n    AND tr.createdtime >= '2023-02-01 00:00:00'\\n    AND tr.createdtime < '2023-09-01 00:00:00'\\n    \\n  GROUP BY 1\\n)\\n\\nSELECT \\n  TO_CHAR(sales_month, 'YYYY-MM') as month_code,\\n  TO_CHAR(sales_month, 'Month YYYY') as month_name,\\n  \\n  ROUND(gross_sales, 2) as gross_sales,\\n  ROUND(returns, 2) as returns,\\n  ROUND(total_discounts, 2) as discounts,\\n  ROUND(tax_collected, 2) as tax,\\n  ROUND(net_sales, 2) as net_sales,\\n  ROUND(total_revenue, 2) as total_revenue,\\n  \\n  sale_transactions,\\n  return_transactions,\\n  total_transactions,\\n  unique_customers,\\n  \\n  ROUND(net_sales / NULLIF(sale_transactions, 0), 2) as avg_transaction_value,\\n  ROUND(returns / NULLIF(gross_sales, 0) * 100, 2) as return_rate_percent,\\n  ROUND(total_discounts / NULLIF(gross_sales, 0) * 100, 2) as discount_rate_percent,\\n  ROUND(unique_customers::DECIMAL / NULLIF(sale_transactions, 0), 2) as customers_per_transaction\\n\\nFROM monthly_sales\\nORDER BY sales_month LIMIT 10;\"},\"results_timezone\":\"Asia/Kuala_Lumpur\",\"requested_timezone\":\"Asia/Kuala_Lumpur\",\"results_metadata\":{\"columns\":[{\"display_name\":\"month_code\",\"field_ref\":[\"field\",\"month_code\",{\"base-type\":\"type/Text\"}],\"name\":\"month_code\",\"base_type\":\"type/Text\",\"effective_type\":\"type/Text\",\"semantic_type\":null,\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Text\":{\"percent-json\":null,\"percent-url\":null,\"percent-email\":null,\"percent-state\":null,\"average-length\":null}}}},{\"display_name\":\"month_name\",\"field_ref\":[\"field\",\"month_name\",{\"base-type\":\"type/Text\"}],\"name\":\"month_name\",\"base_type\":\"type/Text\",\"effective_type\":\"type/Text\",\"semantic_type\":null,\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Text\":{\"percent-json\":null,\"percent-url\":null,\"percent-email\":null,\"percent-state\":null,\"average-length\":null}}}},{\"display_name\":\"gross_sales\",\"field_ref\":[\"field\",\"gross_sales\",{\"base-type\":\"type/Decimal\"}],\"name\":\"gross_sales\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\",\"semantic_type\":null,\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Number\":{\"min\":null,\"q1\":null,\"q3\":null,\"max\":null,\"sd\":null,\"avg\":null}}}},{\"display_name\":\"returns\",\"field_ref\":[\"field\",\"returns\",{\"base-type\":\"type/Decimal\"}],\"name\":\"returns\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\",\"semantic_type\":null,\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Number\":{\"min\":null,\"q1\":null,\"q3\":null,\"max\":null,\"sd\":null,\"avg\":null}}}},{\"display_name\":\"discounts\",\"field_ref\":[\"field\",\"discounts\",{\"base-type\":\"type/Decimal\"}],\"name\":\"discounts\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\",\"semantic_type\":\"type/Discount\",\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Number\":{\"min\":null,\"q1\":null,\"q3\":null,\"max\":null,\"sd\":null,\"avg\":null}}}},{\"display_name\":\"tax\",\"field_ref\":[\"field\",\"tax\",{\"base-type\":\"type/Decimal\"}],\"name\":\"tax\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\",\"semantic_type\":null,\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Number\":{\"min\":null,\"q1\":null,\"q3\":null,\"max\":null,\"sd\":null,\"avg\":null}}}},{\"display_name\":\"net_sales\",\"field_ref\":[\"field\",\"net_sales\",{\"base-type\":\"type/Decimal\"}],\"name\":\"net_sales\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\",\"semantic_type\":null,\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Number\":{\"min\":null,\"q1\":null,\"q3\":null,\"max\":null,\"sd\":null,\"avg\":null}}}},{\"display_name\":\"total_revenue\",\"field_ref\":[\"field\",\"total_revenue\",{\"base-type\":\"type/Decimal\"}],\"name\":\"total_revenue\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\",\"semantic_type\":null,\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Number\":{\"min\":null,\"q1\":null,\"q3\":null,\"max\":null,\"sd\":null,\"avg\":null}}}},{\"display_name\":\"sale_transactions\",\"field_ref\":[\"field\",\"sale_transactions\",{\"base-type\":\"type/BigInteger\"}],\"name\":\"sale_transactions\",\"base_type\":\"type/BigInteger\",\"effective_type\":\"type/BigInteger\",\"semantic_type\":null,\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Number\":{\"min\":null,\"q1\":null,\"q3\":null,\"max\":null,\"sd\":null,\"avg\":null}}}},{\"display_name\":\"return_transactions\",\"field_ref\":[\"field\",\"return_transactions\",{\"base-type\":\"type/BigInteger\"}],\"name\":\"return_transactions\",\"base_type\":\"type/BigInteger\",\"effective_type\":\"type/BigInteger\",\"semantic_type\":null,\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Number\":{\"min\":null,\"q1\":null,\"q3\":null,\"max\":null,\"sd\":null,\"avg\":null}}}},{\"display_name\":\"total_transactions\",\"field_ref\":[\"field\",\"total_transactions\",{\"base-type\":\"type/BigInteger\"}],\"name\":\"total_transactions\",\"base_type\":\"type/BigInteger\",\"effective_type\":\"type/BigInteger\",\"semantic_type\":null,\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Number\":{\"min\":null,\"q1\":null,\"q3\":null,\"max\":null,\"sd\":null,\"avg\":null}}}},{\"display_name\":\"unique_customers\",\"field_ref\":[\"field\",\"unique_customers\",{\"base-type\":\"type/BigInteger\"}],\"name\":\"unique_customers\",\"base_type\":\"type/BigInteger\",\"effective_type\":\"type/BigInteger\",\"semantic_type\":null,\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Number\":{\"min\":null,\"q1\":null,\"q3\":null,\"max\":null,\"sd\":null,\"avg\":null}}}},{\"display_name\":\"avg_transaction_value\",\"field_ref\":[\"field\",\"avg_transaction_value\",{\"base-type\":\"type/Decimal\"}],\"name\":\"avg_transaction_value\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\",\"semantic_type\":null,\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Number\":{\"min\":null,\"q1\":null,\"q3\":null,\"max\":null,\"sd\":null,\"avg\":null}}}},{\"display_name\":\"return_rate_percent\",\"field_ref\":[\"field\",\"return_rate_percent\",{\"base-type\":\"type/Decimal\"}],\"name\":\"return_rate_percent\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\",\"semantic_type\":\"type/Share\",\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Number\":{\"min\":null,\"q1\":null,\"q3\":null,\"max\":null,\"sd\":null,\"avg\":null}}}},{\"display_name\":\"discount_rate_percent\",\"field_ref\":[\"field\",\"discount_rate_percent\",{\"base-type\":\"type/Decimal\"}],\"name\":\"discount_rate_percent\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\",\"semantic_type\":\"type/Discount\",\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Number\":{\"min\":null,\"q1\":null,\"q3\":null,\"max\":null,\"sd\":null,\"avg\":null}}}},{\"display_name\":\"customers_per_transaction\",\"field_ref\":[\"field\",\"customers_per_transaction\",{\"base-type\":\"type/Decimal\"}],\"name\":\"customers_per_transaction\",\"base_type\":\"type/Decimal\",\"effective_type\":\"type/Decimal\",\"semantic_type\":null,\"fingerprint\":{\"global\":{\"distinct-count\":0,\"nil%\":null},\"type\":{\"type/Number\":{\"min\":null,\"q1\":null,\"q3\":null,\"max\":null,\"sd\":null,\"avg\":null}}}}]},\"insights\":null},\n\"cached\":false,\"database_id\":2,\"started_at\":\"2025-07-16T08:01:44.052993Z\",\"json_query\":{\"database\":2,\"native\":{\"query\":\"\\nWITH merchant_info AS (\\n  SELECT \\n    b._id as business_id,\\n    b.name as business_name,\\n    COALESCE(b.timezone, 'Asia/Kuala_Lumpur') as timezone\\n  FROM storehub_mongo.businesses b\\n  WHERE b.name = 'nasikukusnkb' \\n     OR b._id = 'nasikukusnkb'\\n  LIMIT 1\\n),\\n\\nmonthly_sales AS (\\n  SELECT \\n    DATE_TRUNC('month', CONVERT_TIMEZONE(mi.timezone, 'UTC', tr.createdtime)) as sales_month,\\n    \\n    SUM(CASE WHEN tr.transactiontype = 'Sale' THEN tr.subtotal ELSE 0 END) as gross_sales,\\n    \\n    SUM(CASE \\n      WHEN tr.transactiontype = 'Return' THEN ABS(tr.subtotal)\\n      WHEN tr.returnstatus IS NOT NULL AND tr.returnstatus != '' THEN ABS(tr.subtotal) \\n      ELSE 0 \\n    END) as returns,\\n    \\n    SUM(CASE WHEN tr.transactiontype = 'Sale' THEN COALESCE(tr.discount, 0) ELSE 0 END) as total_discounts,\\n    \\n    SUM(CASE WHEN tr.transactiontype = 'Sale' THEN COALESCE(tr.tax, 0) ELSE 0 END) as tax_collected,\\n    \\n    SUM(CASE \\n      WHEN tr.transactiontype = 'Sale' THEN tr.subtotal - COALESCE(tr.discount, 0)\\n      WHEN tr.transactiontype = 'Return' THEN -ABS(tr.subtotal)\\n      WHEN tr.returnstatus IS NOT NULL AND tr.returnstatus != '' THEN -ABS(tr.subtotal)\\n      ELSE 0 \\n    END) as net_sales,\\n    \\n    SUM(CASE \\n      WHEN tr.transactiontype = 'Sale' THEN tr.total\\n      WHEN tr.transactiontype = 'Return' THEN -ABS(tr.total)\\n      WHEN tr.returnstatus IS NOT NULL AND tr.returnstatus != '' THEN -ABS(tr.total)\\n      ELSE 0 \\n    END) as total_revenue,\\n    \\n    COUNT(DISTINCT CASE WHEN tr.transactiontype = 'Sale' THEN tr.receiptnumber END) as sale_transactions,\\n    COUNT(DISTINCT CASE \\n      WHEN tr.transactiontype = 'Return' THEN tr.receiptnumber \\n      WHEN tr.returnstatus IS NOT NULL AND tr.returnstatus != '' THEN tr.receiptnumber\\n    END) as return_transactions,\\n    COUNT(DISTINCT tr.receiptnumber) as total_transactions,\\n    \\n    COUNT(DISTINCT CASE WHEN tr.transactiontype = 'Sale' AND tr.customerid IS NOT NULL THEN tr.customerid END) as unique_customers\\n    \\n  FROM storehub_mongo.transactionrecords tr\\n  CROSS JOIN merchant_info mi\\n  WHERE \\n    tr.business = mi.business_id\\n    \\n    AND tr.createdtime >= '2023-02-01 00:00:00'\\n    AND tr.createdtime < '2023-09-01 00:00:00'\\n    \\n  GROUP BY 1\\n)\\n\\nSELECT \\n  TO_CHAR(sales_month, 'YYYY-MM') as month_code,\\n  TO_CHAR(sales_month, 'Month YYYY') as month_name,\\n  \\n  ROUND(gross_sales, 2) as gross_sales,\\n  ROUND(returns, 2) as returns,\\n  ROUND(total_discounts, 2) as discounts,\\n  ROUND(tax_collected, 2) as tax,\\n  ROUND(net_sales, 2) as net_sales,\\n  ROUND(total_revenue, 2) as total_revenue,\\n  \\n  sale_transactions,\\n  return_transactions,\\n  total_transactions,\\n  unique_customers,\\n  \\n  ROUND(net_sales / NULLIF(sale_transactions, 0), 2) as avg_transaction_value,\\n  ROUND(returns / NULLIF(gross_sales, 0) * 100, 2) as return_rate_percent,\\n  ROUND(total_discounts / NULLIF(gross_sales, 0) * 100, 2) as discount_rate_percent,\\n  ROUND(unique_customers::DECIMAL / NULLIF(sale_transactions, 0), 2) as customers_per_transaction\\n\\nFROM monthly_sales\\nORDER BY sales_month LIMIT 10;\"},\"type\":\"native\",\"middleware\":{\"js-int-to-string?\":true,\"add-default-userland-constraints?\":true}},\"average_execution_time\":null,\"status\":\"completed\",\"context\":\"ad-hoc\",\"row_count\":0,\"running_time\":5393}",
  "status_code": 202
}